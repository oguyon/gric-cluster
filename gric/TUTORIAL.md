# Python Wrapper Tutorial

This tutorial demonstrates how to use the `gric-cluster` python wrapper to generate data, run clustering, and visualize the results.

## 1. Setup

Before using the python wrapper, you need to build the C project to create the necessary binary executables.

From the root of the `gric-cluster` repository, run the following commands:

```bash
mkdir build
cd build
cmake ..
make
```

This will create the required binaries (like `gric-cluster`, `gric-plot`, etc.) inside the `build/` directory.

## 2. Generating Test Data

First, let's generate some sample data to work with. We'll use the `make_test_sequence` function to create a file with 2D points arranged in a circle.

Create a python script named `run_test.py` with the following content:

```python
import os
import shutil
from python.image_cluster import make_test_sequence, ImageCluster, plot_clusters

# Name of the file for our test data
test_data_file = "my_test_data.txt"

# Generate 200 points in a 2D circle pattern
print("Step 1: Generating test data...")
make_test_sequence(200, test_data_file, "2Dcircle")
print(f"-> Test data saved to {test_data_file}")

```

## 3. Running the Clustering

Now that we have our data, we can run the clustering algorithm on it. We'll import the `ImageCluster` class, instantiate it with a radius limit (`rlim`), and then call the `run` method.

Add the following to your `run_test.py` script:

```python
# --- continued from above ---

# Instantiate the clustering tool with a radius limit of 0.5
# We also ask the tool to generate a .clustered.txt file with the `clustered=True` option.
cluster_tool = ImageCluster(rlim=0.5, clustered=True)

# Run clustering on our test data
print("\nStep 2: Running clustering...")
results = cluster_tool.run(test_data_file)

print("-> Clustering complete!")
print(f"   - Total clusters found: {results.get('total_clusters')}")
print(f"   - Output directory: {results.get('output_dir')}")
print(f"   - Log file: {results.get('log_file')}")
if 'assignments' in results:
    print(f"   - {len(results['assignments'])} points were assigned to clusters.")

```

## 4. Visualizing the Results

The clustering process generates a log file and several output files in a directory. We can use the `plot_clusters` function to create a visual summary of the results. This function reads the original data file and the log file generated by the clustering run.

Add this final part to your `run_test.py` script:

```python
# --- continued from above ---

# Plot the results
log_file = results.get('log_file')
if log_file and os.path.exists(log_file):
    print("\nStep 3: Plotting clustering results...")
    plot_file = plot_clusters(test_data_file, log_file)
    if plot_file and os.path.exists(plot_file):
        print(f"-> Plot image saved to: {plot_file}")
    else:
        print("-> Plotting did not produce an output file.")
else:
    print("\nCould not find log file to generate plot.")

# Clean up generated files
print("\nStep 4: Cleaning up...")
os.remove(test_data_file)
if log_file:
    plot_file = test_data_file.replace('.txt', '.png')
    if os.path.exists(plot_file):
        os.remove(plot_file)
output_dir = results.get('output_dir')
if output_dir and os.path.exists(output_dir):
    shutil.rmtree(output_dir)
print("-> Done.")

```

Now, run the script from your terminal:
```bash
python3 run_test.py
```

You should see output indicating the steps being performed, and a `my_test_data.png` file will be created with the plot, which is then removed by the cleanup step.

## 5. Other Utility Functions

The wrapper also provides access to other command-line tools from the project:

- `run_nd_model(dcc_file, ...)`: Performs multi-dimensional scaling on a `dcc.txt` file to create a 3D model of cluster relationships.
- `make_clustered_file(...)`: Re-creates a `.clustered.txt` file if you only have the raw data and a membership file.
- `get_info()`: Prints build information about the `gric-cluster` tools.

You can explore these functions in the `python/image_cluster.py` file for more details on their arguments.
